# 声纹识别系统

## 项目简介
本系统是一个基于Web Audio API的声纹分析与模拟系统，可以实现声纹分析和声纹对比功能。

## 技术栈
- Web Audio API + Canvas（音频处理和可视化）
- Meyda.js（音频特征提取）
- JavaScript

## 算法实现说明
本系统实现了一套声纹特征提取和对比算法，包括时域分析、频域分析和声纹对比三大模块。

### 一、时域特征分析算法

#### 1. 有效音长检测
有效音长指包含语音内容的部分时长，排除静音或非语音部分。在实现过程中，系统首先设定振幅阈值（0.01）用于判断样本是否为有效语音，同时设定短时静音阈值（0.2秒）来允许语音中出现的短暂停顿。在检测过程中，系统遍历音频样本并计算每个样本的绝对振幅值，当检测到振幅超过阈值时，将其标记为语音段开始。对于语音段内出现的短暂静音（小于0.2秒），系统仍将其视为语音的一部分以保持语音的连贯性，而对于超过阈值的静音则视为语音段的结束。通过累加所有有效语音段的时长，最终得到一段音频的有效音长。

#### 2. 过零率
过零率可用于区分浊音和清音，评估语音的清晰度，同时也作为语音活动检测的重要参考指标。系统通过检测相邻采样点的符号变化来判断信号是否穿过零点，每次发现相邻样本的乘积为负数且差值超过最小阈值时，即认为发生了一次过零。通过统计单位时间内的过零次数，并结合采样率进行归一化处理，最终得到反映信号频率特性的过零率。

#### 3. 平均能量
平均能量不仅可以反映语音的响度水平，还可用于语音/静音判断，评估说话人的音量特征，同时在语音分段和端点检测中也发挥着重要作用。首先对每个采样点的振幅值进行平方运算，然后求取所有采样点的平均值得到均方根（RMS）值，最后将RMS值再次平方得到能量值。为了更好地符合人耳的听觉特性，系统采用分贝（dB）作为能量的表示单位，并设置-100dB的最小阈值以避免计算误差。

### 二、频域特征分析算法

#### 1. 基频
基频检测通过分析音频信号的频域特征来确定声音的基本频率（音高）。系统首先对输入信号进行快速傅里叶变换（FFT），获得信号的频谱信息，并根据采样率和FFT点数确定频率分辨率。在人声基频范围（20Hz-2000Hz）内搜索幅度最大的频率分量，同时考虑谐波干扰的影响。为了提高检测的准确性，系统还采用倒谱分析作为辅助手段，并通过考虑基频随时间的连续性特征来优化检测结果。通过结合多种算法的检测结果，最终得到更准确的基频估计。

#### 2. 谐波
谐波检测通过分析信号的谐波结构来反映声音的音色特征。基于检测到的基频，系统计算理论谐波位置，并在每个理论位置附近设定适当的频率容差范围进行搜索。在判断谐波的有效性时，首先计算噪声基准电平，然后设定最小幅度阈值（通常高于噪声10dB），只有幅度超过阈值的频率分量才被认定为有效谐波。对于每个检测到的谐波，系统记录其频率和幅度信息，统计有效谐波的数量，并分析谐波的分布规律，这些信息共同构成了声音的音色特征。

#### 3. 频谱质心
频谱质心通过分析频谱的"重心"位置来反映声音的音色特征。在计算过程中，系统将频率作为"位置"参数，将对应的频谱幅度作为"质量"参数，通过计算加权平均值得到频谱的质心位置。首先计算频率与幅度的加权和，然后除以幅度总和得到质心频率。这个特征能够有效反映声音的"亮度"特性，用于区分不同的音色特征，评估声音的频谱分布情况，是声音特征分析中的重要指标。

### 三、声纹对比算法

#### 1. MFCC特征提取
MFCC（梅尔频率倒谱系数）特征提取是捕获声道特征的关键算法。系统使用Meyda.js库进行特征提取，具体步骤如下：

1. 预处理配置：
   - 设置帧大小(frameSize)为2048
   - 设置跳跃大小(hopSize)为1024
   - 提取13个MFCC系数

2. 提取的特征包括：
   - mfcc（梅尔频率倒谱系数）
   - spectralCentroid（频谱质心）
   - spectralRolloff（频谱滚降）
   - spectralFlatness（频谱平坦度）
   - spectralSpread（频谱扩散）
   - perceptualSpread（感知扩散）
   - perceptualSharpness（感知锐度）
   - rms（短时能量）
   - zcr（过零率）
   - loudness（响度）

#### 2. 相似度计算
声纹相似度计算采用多维特征加权融合的方法，总体相似度由以下三个主要部分组成：

1. 音色特征相似度（权重40%）：
   - 谐波结构匹配度：基于MFCC系数的相似度计算
   - 频谱包络相似度：基于频谱特征（质心、滚降、平坦度、扩散）的综合比较
   - 音色特征匹配：基于频谱质心比率的计算

2. 声学特征相似度（权重30%）：
   - 音高范围匹配（基于频谱质心的范围重叠度、中心频率匹配度和变化幅度匹配度）
   - 能量分布匹配（基于响度值的比较）
   - 共振峰匹配（使用前三个MFCC系数进行比较）

3. 节奏特征相似度（权重30%）：
   - 语速匹配度：基于过零率(ZCR)和RMS能量的统计特征计算
   - 节奏模式相似度：分析RMS能量的变化模式和分布
   - 时长比例匹配：计算两段音频持续时间的比值

相似度计算过程：
1. 对每个特征进行归一化处理，将差异值映射到0-1范围
2. 使用加权平均方法计算各个维度的相似度
3. 最终的总体相似度计算：
   ```
   总体相似度 = 音色特征相似度 * 0.4 + 声学特征相似度 * 0.3 + 节奏特征相似度 * 0.3
   ```

## 使用指南

### 1. 音频输入方式

#### 1.1 麦克风录音
1. 点击"开始录音"按钮
2. 允许浏览器使用麦克风
3. 对着麦克风说话
4. 点击"停止录音"结束

#### 1.2 音频文件导入
1. 点击"选择文件"按钮
2. 选择音频文件（支持格式：wav, mp3）
3. 系统自动开始分析

### 2. 实时分析功能

#### 2.1 波形显示
- 显示音频实时波形
- 显示时域特征参数

#### 2.2 频谱显示
- 显示瞬时频谱图
- 显示频域特征参数

#### 2.3 MFCC可视化
- 显示13个MFCC系数
- 使用热力图表示系数值

### 3. 声纹对比功能

#### 3.1 准备音频
1. 在左侧面板录制或导入第一段音频
2. 在右侧面板录制或导入第二段音频
3. 确保两段音频质量良好
4. 建议音频长度在3-10秒之间

#### 3.2 执行对比
1. 两段音频就绪后点击"对比"按钮
2. 等待系统分析
3. 查看对比结果报告

#### 3.3 结果解读
- 总体相似度：
  * 85%以上：极高相似
  * 70%-85%：高度相似
  * 50%-70%：中等相似
  * 50%以下：差异较大

- 分项相似度：
  * 音色特征匹配度
  * 声学特征匹配度
  * 节奏特征匹配度

## 注意事项

1. 输入音频建议采样率≥16kHz
2. 建议使用降噪后的清晰音频
3. 比对音频的音质和采样率需保持一致
4. 有效音长建议在2-10秒之间
5. 系统可能存在误判情况，建议结合其他信息进行综合判断
6. 首次使用麦克风录音的注意事项：
   - 确保浏览器已获得麦克风使用权限
   - 如果录音时没有实时显示波形，这是正常现象，点击播放后即可正常显示